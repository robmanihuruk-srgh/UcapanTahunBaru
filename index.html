<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Kartu Ucapan Digital ‚Äì 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: Inter, sans-serif; color: #f5f5f5;
      background: radial-gradient(circle at top, #0b1430, #000);
      min-height: 100vh; overflow-x: hidden;
    }
    canvas#fx { position: fixed; inset: 0; z-index: 0 }

    .container {
      position: relative; z-index: 1; min-height: 100vh;
      display: flex; align-items: center; justify-content: center; padding: 24px;
    }
    .card {
      width: 100%; max-width: 820px; background: rgba(255,255,255,.08);
      border-radius: 30px; backdrop-filter: blur(22px);
      box-shadow: 0 50px 160px rgba(0,0,0,.9); overflow: hidden;
      animation: rise 1.3s ease forwards;
    }
    @keyframes rise { from {opacity:0; transform:translateY(50px)} to {opacity:1; transform:none} }

    .photo-wrapper { display:flex; flex-direction:column; align-items:center; padding: 24px 24px 0; }
    .photo {
      width: 100%; max-height: 400px; border-radius: 22px; overflow: hidden;
      box-shadow: 0 25px 80px rgba(0,0,0,.7); display: flex; justify-content: center;
      background: rgba(0,0,0,0.2);
    }
    .photo img { max-width: 100%; max-height: 400px; height: auto; width: auto; object-fit: contain; }

    .content { padding: 20px 32px 42px; text-align:center }
    h1 { font-family:'Playfair Display',serif; font-size:clamp(24px,5vw,42px); margin:18px 0 6px; }
    h1 span { color:#ffd88a; text-shadow:0 0 22px rgba(255,216,138,.8); display: block; }
    
    .subtitle { font-size:13px; opacity:.85; letter-spacing: 2px; text-transform: uppercase; }
    .verse { margin:22px auto 0; min-height: 80px; max-width:520px; line-height:1.7; font-size:15px; font-style: italic; color: #e0e0e0; }
    .signature { margin-top:20px; font-weight:600; color:#ffd88a; font-size: 1.2em; }

    .editor { margin-top:20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
    .editor input { 
      padding:12px 18px; border-radius:12px; border: 1px solid rgba(255,255,255,0.2); 
      width: 80%; max-width:340px; background: rgba(255,255,255,0.1); color: #fff; text-align: center; margin-bottom: 15px;
    }

    .top-action { position:fixed; top:16px; right:16px; z-index:10 }
    .btn { 
      padding:12px 22px; border-radius:16px; background:rgba(255,216,138,.2); 
      border:1px solid rgba(255,216,138,.4); color:#ffd88a; cursor:pointer; 
      backdrop-filter: blur(10px); font-weight: 600; transition: 0.3s; display: none;
    }
    .btn:hover { background: rgba(255,216,138,0.4); }
    .btn-secondary { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: #fff; display: block; margin: 0 auto;}

    .locked .editor, .locked #photoInput { display:none }
  </style>
</head>
<body>

<canvas id="fx"></canvas>
<audio id="music" loop><source src="Music_NewYear.mp4" type="audio/mp4"></audio>

<div class="top-action">
  <button class="btn" id="shareBtn">üì§ Bagikan Kartu</button>
  <button class="btn" id="playBtn">üéµ Tekan Disini Untuk Musik</button>
</div>

<div class="container" id="app">
  <div class="card">
    <div class="photo-wrapper">
      <div class="photo">
        <img id="photoPreview" src="faminbali.jfif" alt="Foto Keluarga" />
      </div>
      <input type="file" id="photoInput" accept="image/*" style="margin-top:14px;color:#ccc; font-size: 11px;" />
    </div>

    <div class="content">
      <h1>SELAMAT TAHUN BARU <span>2026</span></h1>
      <div class="subtitle">GKPS Tangerang ‚Ä¢ Sukacita ‚Ä¢ Berkat</div>
      <div class="verse" id="verse"></div>
      <div class="signature" id="sign"></div>
      <div class="editor">
        <input type="text" id="nameInput" placeholder="Masukkan Nama Keluarga" />
        <button class="btn btn-secondary" id="randomBtn">‚ú® Ganti Kata Mutiara</button>
      </div>
    </div>
  </div>
</div>

<script>
// --- Particle Background ---
const c=document.getElementById('fx'),x=c.getContext('2d'); let w,h,p=[];
function rs(){w=c.width=innerWidth;h=c.height=innerHeight} rs(); addEventListener('resize',rs);
for(let i=0;i<120;i++)p.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*2+0.5,s:Math.random()+0.2});
(function a(){x.clearRect(0,0,w,h);p.forEach(o=>{o.y+=o.s;o.y%=h;x.fillStyle='rgba(255,215,140,.7)';x.beginPath();x.arc(o.x,o.y,o.r,0,7);x.fill()});requestAnimationFrame(a)})();

// --- Data ---
const LIST_UCAPAN = [
  "‚ÄúSegala Impian dan Harapan Terwujud, Diberikan Kesehatan, Kebahagiaan, dan Rezeki yang Mengalir Deras.‚Äù",
  "‚ÄúKiranya terang Ilahi menyertai setiap langkah kita di tahun 2026, membawa damai sejahtera bagi kita semua.‚Äù",
  "‚ÄúTahun baru adalah lembaran bersih untuk menuliskan cerita indah dalam iman dan pengharapan yang baru.‚Äù",
  "‚ÄúBerjalanlah dengan iman di tahun 2026. Kiranya berkat Tuhan melimpah atas rumah tangga dan pekerjaan kita.‚Äù"
];

const q=new URLSearchParams(location.search);
const nameParam=q.get('name');
const quoteIdx=q.get('v');
const imgParam=q.get('img');

const photoPreview=document.getElementById('photoPreview');
const shareBtn=document.getElementById('shareBtn');
const playBtn=document.getElementById('playBtn');
const music=document.getElementById('music');
const signEl=document.getElementById('sign');
const nameInput=document.getElementById('nameInput');

let currentQuoteIndex = quoteIdx ? parseInt(quoteIdx) : 0;
let base64Img = ""; 

// --- Logic Tampilan ---
if(nameParam) {
    document.getElementById('app').classList.add('locked');
    signEl.textContent = nameParam;
    playBtn.style.display = 'block';
    if(imgParam) photoPreview.src = imgParam; // Tampilkan foto kiriman
} else {
    shareBtn.style.display = 'block';
}

// Typewriter
function typeWriter(text, i = 0) {
  if (i === 0) document.getElementById('verse').textContent = '';
  if (i < text.length) {
    document.getElementById('verse').textContent += text[i];
    setTimeout(() => typeWriter(text, i + 1), 35);
  }
}
typeWriter(LIST_UCAPAN[currentQuoteIndex]);

// Event: Musik
playBtn.onclick = () => {
    music.play().catch(()=>{});
    playBtn.innerHTML = "üéµ Musik Aktif";
    setTimeout(() => playBtn.style.display = 'none', 1500);
};

// Event: Ganti Teks
document.getElementById('randomBtn').onclick = () => {
  currentQuoteIndex = (currentQuoteIndex + 1) % LIST_UCAPAN.length;
  typeWriter(LIST_UCAPAN[currentQuoteIndex]);
};

// Event: Input Nama
nameInput.oninput = () => signEl.textContent = nameInput.value;

// --- AGAR FOTO BISA IKUT SHARING (SUPER COMPRESSION) ---
document.getElementById('photoInput').onchange = e => {
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = event => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      const MAX_SIZE = 300; // Ukuran kecil agar URL tidak Error
      let width = img.width;
      let height = img.height;

      if (width > height) {
        if (width > MAX_SIZE) { height *= MAX_SIZE / width; width = MAX_SIZE; }
      } else {
        if (height > MAX_SIZE) { width *= MAX_SIZE / height; height = MAX_SIZE; }
      }

      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, width, height);

      // Gunakan kualitas 0.4 (Sangat Efisien untuk URL)
      base64Img = canvas.toDataURL('image/jpeg', 0.4);
      photoPreview.src = base64Img;
    };
    img.src = event.target.result;
  };
  reader.readAsDataURL(file);
};

// Event: Bagikan
shareBtn.onclick = () => {
  const n = nameInput.value.trim();
  if(!n) { alert("Isi nama pengirim dulu Pak."); return; }
  
  // Buat URL. Jika ada foto baru, masukkan ke parameter img
  let finalUrl = `${location.origin}${location.pathname}?name=${encodeURIComponent(n)}&v=${currentQuoteIndex}`;
  if(base64Img) finalUrl += `&img=${encodeURIComponent(base64Img)}`;

  if(finalUrl.length > 7000) {
      alert("Foto masih terlalu besar. Coba gunakan foto dengan resolusi lebih rendah.");
      return;
  }

  if(navigator.share) {
    navigator.share({ title: 'Kartu Ucapan Digital', url: finalUrl });
  } else {
    navigator.clipboard.writeText(finalUrl).then(() => alert("Link disalin!"));
  }
};
</script>
</body>
</html>

