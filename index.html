<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Kartu Ucapan Digital ‚Äì 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, sans-serif;
      color: #f5f5f5;
      background: radial-gradient(circle at top, #0b1430, #000);
      min-height: 100vh;
      overflow-x: hidden;
    }
    canvas#fx { position: fixed; inset: 0; z-index: 0 }

    .container {
      position: relative; z-index: 1;
      min-height: 100vh; display: flex; align-items: center; justify-content: center;
      padding: 24px;
    }
    .card {
      width: 100%; max-width: 820px;
      background: rgba(255,255,255,.08);
      border-radius: 30px;
      backdrop-filter: blur(22px);
      box-shadow: 0 50px 160px rgba(0,0,0,.9);
      overflow: hidden;
      animation: rise 1.3s ease forwards;
    }
    @keyframes rise { from {opacity:0; transform:translateY(50px)} to {opacity:1; transform:none} }

    .photo-wrapper { 
      display:flex; 
      flex-direction:column; 
      align-items:center; 
      padding: 24px 24px 0;
    }
    .photo {
      width: 100%;
      /* Menggunakan aspect-ratio agar tetap proporsional baik landscape maupun portrait */
      aspect-ratio: 16 / 9; 
      max-height: 500px;
      border-radius: 22px;
      overflow: hidden;
      box-shadow: 0 25px 80px rgba(0,0,0,.7);
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.4);
    }
    /* Menangani Portrait agar tidak terpotong */
    .photo.portrait {
        aspect-ratio: 4 / 5;
    }
    
    .photo img { 
      width: 100%;
      height: 100%;
      object-fit: contain; /* Memastikan seluruh gambar terlihat tanpa terpotong */
    }

    .content { padding: 20px 32px 42px; text-align:center }
    h1 { font-family:'Playfair Display',serif; font-size:clamp(28px,5vw,48px); margin:18px 0 6px; letter-spacing: 1px; }
    h1 span { color:#ffd88a; text-shadow:0 0 22px rgba(255,216,138,.8) }
    
    .subtitle { font-size:15px; opacity:.85; letter-spacing: 2px; text-transform: uppercase; }
    .verse { margin:22px auto 0; min-height: 80px; max-width:520px; line-height:1.9; font-size:16px; font-style: italic; color: #e0e0e0; }
    .signature { margin-top:26px; font-weight:600; color:#ffd88a; font-size: 1.3em; }

    .editor { margin-top:20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
    .editor input { 
      padding:12px 18px; 
      border-radius:12px; 
      border: 1px solid rgba(255,255,255,0.2); 
      width: 80%; 
      max-width:340px; 
      background: rgba(255,255,255,0.1);
      color: #fff;
      margin-bottom: 15px;
      text-align: center;
    }

    .btn-group { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
    
    .top-action { position:fixed; top:16px; right:16px; z-index:10 }
    .btn { 
      padding:12px 22px; 
      border-radius:16px; 
      background:rgba(255,216,138,.2); 
      border:1px solid rgba(255,216,138,.4); 
      color:#ffd88a; 
      cursor:pointer; 
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      font-weight: 600;
      display: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .btn:hover { background: rgba(255,216,138,0.4); transform: translateY(-2px); }
    .btn-secondary { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: #fff; }

    .locked .editor, .locked #photoInput { display:none }

    @media (max-width:480px){ 
      .photo { aspect-ratio: 1/1; }
      .photo img { max-height: 350px; } 
      .content { padding:26px 15px 36px } 
    }
  </style>
</head>
<body>

<canvas id="fx"></canvas>

<audio id="music" loop>
  <source src="Music_NewYear.mp4" type="audio/mp4">
</audio>

<div class="top-action">
  <button class="btn" id="shareBtn">üì§ Bagikan Kartu</button>
  <button class="btn" id="playBtn">üéµ Tekan Disini Untuk Musik</button>
</div>

<div class="container" id="app">
  <div class="card">
    <div class="photo-wrapper">
      <div class="photo" id="photoContainer">
        <img id="photoPreview" src="faminbali.jfif" alt="Foto Keluarga" />
      </div>
      <input type="file" id="photoInput" accept="image/*" style="margin-top:14px;color:#ccc; font-size: 11px;" />
    </div>

    <div class="content">
      <h1>SELAMAT TAHUN BARU <span>2026</span></h1>
      <div class="subtitle">Damai ‚Ä¢ Sukacita ‚Ä¢ Berkat</div>
      
      <div class="verse" id="verse"></div>
      <div class="signature" id="sign"></div>
      
      <div class="editor">
        <input type="text" id="nameInput" placeholder="Masukkan Nama Anda / Keluarga" />
        <div class="btn-group">
            <button class="btn btn-secondary" id="randomBtn" style="display: block;">‚ú® Ganti Kata Mutiara</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// --- Background Particle ---
const c=document.getElementById('fx'),x=c.getContext('2d'); let w,h,p=[];
function rs(){w=c.width=innerWidth;h=c.height=innerHeight} rs(); addEventListener('resize',rs);
for(let i=0;i<120;i++)p.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*2+0.5,s:Math.random()+0.2});
(function a(){x.clearRect(0,0,w,h);p.forEach(o=>{o.y+=o.s;o.y%=h;x.fillStyle='rgba(255,215,140,.7)';x.beginPath();x.arc(o.x,o.y,o.r,0,7);x.fill()});requestAnimationFrame(a)})();

// --- Data ---
const LIST_UCAPAN = [
  "‚ÄúSegala Impian dan Harapan Terwujud, Diberikan Kesehatan, Kebahagiaan, dan Rezeki yang Mengalir Deras.‚Äù",
  "‚ÄúKiranya terang Ilahi menyertai setiap langkah kita di tahun 2026, membawa damai sejahtera bagi kita semua.‚Äù",
  "‚ÄúSelamat tinggal masa lalu, selamat datang masa depan. Semoga kasih Tuhan selalu menyertai perjalanan keluarga kita.‚Äù",
  "‚ÄúTahun baru adalah lembaran bersih untuk menuliskan cerita indah dalam iman dan pengharapan yang baru.‚Äù",
  "‚ÄúBerjalanlah dengan iman di tahun 2026. Kiranya berkat Tuhan melimpah atas rumah tangga dan pekerjaan kita.‚Äù",
  "‚ÄúTuhan membuat segala sesuatu indah pada waktunya. Selamat menyambut tahun penuh mukjizat dan anugerah.‚Äù"
];

const q=new URLSearchParams(location.search); 
const nameParam=q.get('name');
const quoteIdx=q.get('v'); 
const app=document.getElementById('app');
const signEl=document.getElementById('sign');
const verseEl=document.getElementById('verse');
const nameInput=document.getElementById('nameInput');
const photoInput=document.getElementById('photoInput');
const photoContainer=document.getElementById('photoContainer');
const shareBtn=document.getElementById('shareBtn');
const playBtn=document.getElementById('playBtn');
const music = document.getElementById('music');

let currentQuoteIndex = quoteIdx ? parseInt(quoteIdx) : 0;
let typingTimer;

function typeWriter(text, i = 0) {
  if (i === 0) verseEl.textContent = '';
  if (i < text.length) {
    verseEl.textContent += text[i];
    typingTimer = setTimeout(() => typeWriter(text, i + 1), 40);
  }
}

if(nameParam) {
    app.classList.add('locked');
    signEl.textContent = nameParam;
    playBtn.style.display = 'block';
    shareBtn.style.display = 'none';
} else {
    shareBtn.style.display = 'block';
    playBtn.style.display = 'none';
}

typeWriter(LIST_UCAPAN[currentQuoteIndex]);

playBtn.onclick = () => {
    music.play().catch(e => console.log("Audio play failed"));
    playBtn.innerHTML = "üéµ Musik Aktif";
    playBtn.style.opacity = "0.7";
    setTimeout(() => { playBtn.style.display = 'none'; }, 2000);
};

document.getElementById('randomBtn').onclick = () => {
  let newIdx;
  do { newIdx = Math.floor(Math.random() * LIST_UCAPAN.length); } while (newIdx === currentQuoteIndex);
  clearTimeout(typingTimer);
  currentQuoteIndex = newIdx;
  typeWriter(LIST_UCAPAN[newIdx]);
};

nameInput.addEventListener('input',()=>signEl.textContent=nameInput.value);

// --- FITUR PERBAIKAN FOTO (RESIZE & ORIENTATION) ---
photoInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(event) {
    const img = new Image();
    img.onload = function() {
      // Tentukan Maksimal Dimensi (Contoh 1200px agar ringan tapi tajam)
      const MAX_WIDTH = 1200;
      const MAX_HEIGHT = 1200;
      let width = img.width;
      let height = img.height;

      // Logika Resizing proporsional
      if (width > height) {
        if (width > MAX_WIDTH) {
          height *= MAX_WIDTH / width;
          width = MAX_WIDTH;
        }
      } else {
        if (height > MAX_HEIGHT) {
          width *= MAX_HEIGHT / height;
          height = MAX_HEIGHT;
        }
      }

      // Deteksi Portrait vs Landscape untuk CSS
      if (img.height > img.width) {
        photoContainer.classList.add('portrait');
      } else {
        photoContainer.classList.remove('portrait');
      }

      // Gambar ulang ke canvas untuk kompresi
      const canvas = document.createElement('canvas');
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, width, height);

      // Export sebagai base64 dengan kualitas 0.7 (70%)
      const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
      document.getElementById('photoPreview').src = dataUrl;
    };
    img.src = event.target.result;
  };
  reader.readAsDataURL(file);
});

shareBtn.onclick=()=>{
  const nameVal = nameInput.value.trim(); 
  if(!nameVal){alert('Silakan isi nama pengirim terlebih dahulu');return}
  const url=`${location.origin}${location.pathname}?name=${encodeURIComponent(nameVal)}&v=${currentQuoteIndex}`;
  
  if(navigator.share){
    navigator.share({title: 'Kartu Ucapan Digital 2026', text: `Dari ${nameVal} untuk Anda ‚ú®`, url: url});
  } else {
    navigator.clipboard?.writeText(url).then(()=>alert('Link kartu telah disalin! Silakan kirim ke WhatsApp.'));
  }
};
</script>
</body>
</html>

